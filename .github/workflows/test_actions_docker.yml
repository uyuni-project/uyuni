name: hello-world
on: pull_request
jobs:
  test-uyuni:
    runs-on: ubuntu-latest
    steps:
      - name: hello_world
        run: echo "Hello World 3!"
      - name: Log in to the Container registry                        
        uses: docker/login-action@f054a8b539a109f9f41c372932f1ae047eff08c9
        with:                                                         
          registry: ghcr.io                                           
          username: ${{ github.actor }}                               
          password: ${{ secrets.GITHUB_TOKEN }}         
      - uses: actions/checkout@v3
      - uses: isbang/compose-action@v1.4.1
      - name: wait a bit
        run: sleep 30s  
      - name: dockerps
        run: docker ps
      - name: install-deps
        run: sudo apt-get install -y nmap
      - name: nmap_from_host
        run: nmap server-httpd-test
      - name: docker-networks
        run: docker network ls
      - name: test_from_host
        run: curl http://localhost:1234/test.html
      - name: test_from_container
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: docker run -a stdout -a stderr --network uyuni_default ghcr.io/uyuni-project/uyuni/controller-dev:master bash -c "echo helloworld"
      - name: last-step
        run: echo "bye bye!"


