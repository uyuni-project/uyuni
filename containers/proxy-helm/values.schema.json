{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Uyuni Proxy Helm Chart Values",
  "type": "object",
  "required": ["global"],
  "properties": {
    "repository": {
      "type": "string",
      "default": "registry.opensuse.org/uyuni",
      "description": "The default repository for images."
    },
    "tag": {
      "type": "string",
      "default": "latest",
      "description": "The default image tag."
    },
    "pullPolicy": {
      "type": "string",
      "enum": ["Always", "Never", "IfNotPresent"],
      "default": "Always",
      "description": "Kubernetes image pull policy."
    },
    "registrySecret": {
      "type": "string",
      "default": "",
      "description": "Name of the secret containing credentials for the registry"
    },
    "global": {
      "type": "object",
      "required": ["config", "httpd", "ssh"],
      "properties": {
        "config": {
          "type": "string",
          "description": "YAML content of config.yaml generated by the server"
        },
        "httpd": {
          "type": "string",
          "description": "YAML content of httpd.yaml generated by the server"
        },
        "ssh": {
          "type": "string",
          "description": "YAML content of ssh.yaml generated by the server"
        }
      }
    },
    "ingress": {
      "type": ["object", "null"],
      "properties": {
        "type": {
          "type": "string",
          "default": "traefik",
          "description": "The ingress controller type being used."
        },
        "class": {
          "type": "string",
          "default": "",
          "description": "The ingress class name."
        },
        "annotations": {
          "type": "object",
          "properties": {
            "ssl": {
              "type": ["object", "null"],
              "description": "Custom annotations for SSL ingress rules."
            }
          }
        }
      }
    },
    "volumes": {
      "type": ["object", "null"],
      "properties": {
        "squid": { "$ref": "#/definitions/volumeConfig" }
      }
    },
    "services": {
      "type": ["object", "null"],
      "properties": {
        "type": {
          "type": "string",
          "default": "ClusterIP",
          "description": "Kubernetes Service type (e.g., ClusterIP, NodePort)."
        },
        "annotations": {
          "type": ["object", "null"],
          "description": "annotations to set to all the services"
        }
      }
    },
    "httpd": { "$ref": "#/definitions/componentConfig" },
    "squid": { "$ref": "#/definitions/componentConfig" },
    "ssh": { "$ref": "#/definitions/componentConfig" },
    "tftp": {
      "type": ["object", "null"],
      "description": "configuration of the tftp server component",
      "allOf": [
        { "$ref": "#/definitions/imageConfig" }
      ],
      "properties": {
        "hostNetwork": {
          "type": "boolean",
          "description": "Use the host network instead of Kubernetes network infrastructure",
          "default": false
        }
      }
    },
    "salt": { "$ref": "#/definitions/componentConfig" }
  },
  "definitions": {
    "imageConfig": {
      "type": ["object", "null"],
      "properties": {
        "image": { "type": ["string", "null"], "description": "Override default image name" },
        "tag": { "type": ["string", "null"], "description": "Override default tag" }
      }
    },
    "componentConfig": {
      "type": ["object", "null"],
      "allOf": [ { "$ref": "#/definitions/imageConfig"} ],
      "properties": {
        "image": { "type": ["string", "null"], "description": "Override default image name" },
        "tag": { "type": ["string", "null"], "description": "Override default tag" },
        "tuning": { "type": ["string", "null"], "description": "Configuration tuning parameters" },
        "ports": {
          "type": ["object", "null"],
          "additionalProperties": { "type": "integer" },
          "description": "NodePort values used if service type is NodePort"
        }
      }
    },
    "volumeConfig": {
      "type": "object",
      "properties": {
        "storageClass": {
          "type": ["string", "null"],
          "description": "storage class to use for the volume claim"
        },
        "extraLabels": {
          "type": ["object", "null"],
          "description": "labels to add to the volume claim"
        },
        "annotations": {
          "type": ["object", "null"],
          "description": "annotations to set to the volume claim"
        },
        "volumeName": {
          "type": ["string", "null"],
          "description": "volume to force binding to if set"
        },
        "selector": {
          "type": ["object", "null"],
          "description": "selector to set on the volume claim"
        }
      }
    }
  }
}
