[[ref.webui.audit.subscription]]
= Subscription Matching

To match subscriptions with your systems use the Subscription Matcher tool.

The [guimenu]``Edit Virtual Host Managers`` link in the upper right corner will take you to the menu:Main Menu[Systems > Virtual Host Managers] overview.

For more information about Virtual Host Managers, see: xref:reference:systems/virtual-host-managers.adoc[Virtual Host Managers]

image::audit_subscription_matching.png[scaledwidth=80%]

It gathers information about systems, subscriptions and pinned matches (fixed customer defined subscriptions to systems mapping) as input and returns the best possible match according to the SUSE Terms and Conditions.
The Subscription Matcher ([command]``subscription-matcher``) is also able to write CSV Reports.

* The [guimenu]``Subscriptions Report`` provides subscriptions report data when used
* The [guimenu]``Unmatched Products Report`` provides information on products and their systems when a match to a subscription cannot be found
* The [guimenu]``Error Report`` provides a list of errors raised during the matching process

Selecting menu:Main Menu[Audit > Subscription Matching] from the left navigation menu will provide you with an overview of all results generated by the Subscription Matcher.


[IMPORTANT]
.Subscription Matcher Accuracy
====
This tool's goal is to help provide visual coverage on current subscription use and support reporting.
The Subscription Matcher is excellent at matching systems and products registered with {productname}, however any systems, products or environments which are not found in the database will remain unmatched.
This tool is not intended to act as a replacement for auditing.
Auditing should always take precedence over subscription matching.
====



== Subscriptions

The Subscription Matching overview provides subscription part numbers, product descriptions, policies, matched total subscriptions used and remaining, and the start and end dates of subscriptions.

.Subscription Matching Overview
image::smatching-overview.png[scaledwidth=80%]

Part Number::
Identifier of a particular product

Description::
Name of a particular product

Policy::
Kind of the subscription of this product

Matched/Total::
** {empty}
+

.Fully Matched
If the total amounts of a subscription are fully matched, the quantity column value is highlighted with a yellow warning triangle: image:fa-warning.svg[Warning,scaledwidth=0.9em]
** {empty}
+

.Susbscritions about to Expire
When a subscription will expire within less than 3Â months, the record is highlighted.
** {empty}
+

.Expired Subscriptions
If a subscription is expired, the record for it is faded.

Start Date::
Start date of the subscription

End Date::
End date of the subscription

== Subscription Matcher Reports

{productname} automatically generates up-to-date nightly status reports by matching your {suse} subscriptions with all your registered systems.
These reports are stored in [path]``/var/lib/spacewalk/subscription-matcher`` and provided in CSV format.
These CSV files may be opened with a spreadsheet application such as LibreOffice Calc.

If you want to schedule these reports to be produced at different times, or at a certain frequency or schedule a one time completion you can perform this task by editing the Taskomatic settings for the gatherer-matcher located in the {webui} at menu:Main Menu[Admin > Task Schedules > gatherer-matcher-default].

image::audit_subscription_matching_gatherer_matcher_default.png[scaledwidth=80%]



[[ref.webui.audit.submatch.unmatched.systems]]
== Unmatched Products

Selecting the menu:Main Menu[Subscription Matching > Unmatched Products] tab provides an overview of all systems the matcher could not find in the database or which were not registered with {productname}.
The [guimenu]``Unmatched Products`` overview contains product names and the number of systems which remain unmatched with known installed products.

.Unmatched Products
image::audit_subscription_matching_unmatched_products.png[scaledwidth=80%]

Show System List::
Select to open and display a list of all systems which were detected with an installed product but remain unmatched with a subscription.



[[ref.webui.audit.submatch.sub.pinning]]
== Pins

The subscription pinning feature allows a user to instruct the subscription matcher to favor matching a specific subscription with a given system or group of systems.
This is achieved by creating pins.
Each pin contains information about the preferred subscription-system match.

image::audit_subscription_matching_pins.png[scaledwidth=80%]

[NOTE]
.Respecting Pins
====
In some cases the algorithm may determine that a specific pin cannot be respected, depending on the subscription's availability and applicability rules, in this case it will be shown as not satisfied.
====

The pins table displays a list of all pins.
Items in the list contain the status of pins, which can be ``satisfied``, `not    satisfied` and ``pending next run``.

* A pin is `satisfied` if its system and subscription was matched in the last matcher run.
* A pin is `not satisfied` if its system and subscription was _not_ matched in the last matcher run.
This can happen, for example, if the pin violates terms and conditions for subscriptions.
* A pin is in the `pending next run` state when it needs a new matcher run to be taken into account.
After the new run, the pin will become either `satisfied` or ``not satisfied``.

image::sm-pins.png[scaledwidth=80%]

Click the btn:[Add a Pin] button to open the [guimenu]``Available Systems`` window.
You may filter systems by name and select a system for the matcher to pin manually.

image::add-pin.png[scaledwidth=80%]

Within the menu:Subscriptions Available for Selected System[] window click the menu:Save Pin[] button to raise priority for subscription use on the selected system.



[[ref.webui.audit.submatch.submatch.messages]]
== Messages

You can review all messages related to [guimenu]``Subscription Matching`` from the menu:Main Menu[Audit > Subscription Matching > Messages] overview.

The following status messages can be displayed.

Unknown Part Number::
Unsupported part number detected

Physical Guest::
Physical system is reported as virtual guest, check hardware data

Guest with Unknown Host::
Virtual guest has unknown host, assuming it is a physical system

Unknown CPU Count::
System has an unknown number of sockets, assuming 16.
You can try fixing this by scheduling hardware refresh for affected system.

image::audit_subscription_matching_messages.png[scaledwidth=80%]
