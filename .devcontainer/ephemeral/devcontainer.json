{
  "name": "Uyuni Master (Podman)",
  // Use Tumbleweed so we can easily 'zypper install mgradm'
  "image": "registry.opensuse.org/opensuse/tumbleweed:latest",
  
  "features": {
    // Installs common tools (git, curl, etc.)
    "ghcr.io/devcontainers/features/common-utils:2": {},
    // Installs Podman and configures user namespaces
    "ghcr.io/devcontainers/features/podman:1": {
      "version": "latest",
      "dockerSocketPath": "/var/run/docker.sock" 
    }
  },

  // CRITICAL: Podman-in-Docker/Container requires privileged mode
  "runArgs": [
    "--privileged", 
    "--cgroupns=host",
    "-v", "/sys/fs/cgroup:/sys/fs/cgroup:rw" 
  ],

  // Expose Uyuni ports
  "forwardPorts": [443, 80, 4505, 4506],

  // Run setup script
  "postCreateCommand": "bash .devcontainer/ephemeral/setup_uyuni.sh",
  
  "customizations": {
    "vscode": {
      "extensions": [
        // Useful for managing the inner containers
        "ms-azuretools.vscode-docker" 
      ]
    }
  }
}
