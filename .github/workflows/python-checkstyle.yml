name: Python checkstyle

on:
  # push:
  #   branches:
  #     - master
  #   paths:
  #     - 'java/**.java'
  #     - 'java/**.xml'
  #     - '.github/workflows/java-checkstyle.yml'
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
    # paths:
    #   # We also trigger on non-java code changes since this triggers sonarcloud scanner after
    #   - '**.py'
    #   - 'web/html/src/**.ts'
    #   - 'web/html/src/**.tsx'
    #   - 'java/**.java'
    #   - 'java/**.xml'
    #   - '.github/workflows/java-checkstyle.yml'

jobs:
  checkstyle:
    runs-on: ubuntu-latest
    container: registry.opensuse.org/home/mczernek/containers/opensuse_factory_containerfile/uyuni-lint:latest

    steps:
    - uses: actions/checkout@v4
    - uses: jitterbit/get-changed-files@v1
      id: changed_files
      continue-on-error: true

    # - name: Test container dependencies
    #   run: |
    #     black --version
    #     pylint --version
    #     ls -l /github/
    #     echo
    #     echo $GITHUB_WORKSPACE
    
    # - name: Test mounts
    #   run: |
    #     # echo ".workspace" && ls -l /home/runner/work/uyuni/uyuni || echo "not found"
    #     # echo
    #     # echo "__w" && ls -la /__w/uyuni/uyuni
    #     git config --global --add safe.directory '*'
    #     cd /__w/uyuni/uyuni && git status || echo "git failed"
    - name: Filter python files
      id: filter
      run: |
        echo "added=echo ${{ steps.changed_files.outputs.added }} | grep .py" >> $GITHUB_OUTPUT
        echo "renamed=echo ${{ steps.changed_files.outputs.renamed }} | grep .py" >> $GITHUB_OUTPUT
        echo "modified=echo ${{ steps.changed_files.outputs.modified }} | grep .py" >> $GITHUB_OUTPUT
        echo "added_modified=echo ${{ steps.changed_files.outputs.added_modified }} | grep .py" >> $GITHUB_OUTPUT
    - name: Print python files
      env:
        PY_FILES: ${{join(steps.filter.outputs.*, ' ')}}
      run: |
        echo $PY_FILES
