<!--
  ~ Copyright (c) 2022 SUSE LLC
  ~
  ~ This software is licensed to you under the GNU General Public License,
  ~ version 2 (GPLv2). There is NO WARRANTY for this software, express or
  ~ implied, including the implied warranties of MERCHANTABILITY or FITNESS
  ~ FOR A PARTICULAR PURPOSE. You should have received a copy of GPLv2
  ~ along with this software; if not, see
  ~ http://www.gnu.org/licenses/old-licenses/gpl-2.0.txt.
  ~
  ~ Red Hat trademarks are not licensed under GPLv2. No permission is
  ~ granted to use or replicate Red Hat trademarks that are incorporated
  ~ in this software or its documentation.
  -->
<datasource_modes>


<mode name="Channel" class="">
    <query>
          SELECT rhnchannel.id AS channel_id
                      , rhnchannel.name
                      , rhnchannel.label
                      , CASE 
                          WHEN rhnchannel.org_id IS NULL THEN 'Vendor'
                          ELSE 'Custom'
                        END AS type
                      , rhnproductname.name AS product_name
                      , rhnchannelarch.name AS arch
                      , rhnchannel.description
                      , rhnparentchannel.label AS parent_channel_label
                      , web_customer.name AS organization 
            FROM rhnchannel
                      LEFT JOIN rhnproductname ON rhnchannel.product_name_id = rhnproductname.id
                      LEFT JOIN rhnchannelarch ON rhnchannel.channel_arch_id = rhnchannelarch.id
                      LEFT JOIN rhnchannel rhnparentchannel ON rhnchannel.parent_channel = rhnparentchannel.id
                      LEFT JOIN web_customer ON rhnchannel.org_id = web_customer.id
  </query>
</mode>

<mode name="Errata" class="">
    <query>
          SELECT rhnerrata.id AS errata_id
                      , rhnerrata.advisory_name
                      , rhnerrata.advisory_type
                      , rhnerrata.issue_date
                      , rhnerrata.update_date
                      , rhnerrata.product
                      , rhncve.name AS cve
                      , rhnerrata.synopsis
                      , rhnchannel.label AS channel_label
                      , web_customer.name AS organization 
            FROM rhnerrata
                      LEFT JOIN rhnerratacve ON rhnerrata.id = rhnerratacve.errata_id
                      LEFT JOIN rhncve ON rhnerratacve.cve_id = rhncve.id
                      LEFT JOIN rhnchannelerrata ON rhnerrata.id = rhnchannelerrata.errata_id
                      LEFT JOIN rhnchannel ON rhnchannelerrata.channel_id = rhnchannel.id
                      LEFT JOIN web_customer ON rhnerrata.org_id = web_customer.id
  </query>
</mode>

<mode name="Package" class="">
    <query>
          SELECT rhnpackage.id AS package_id
                      , rhnpackagename.name
                      , rhnpackageevr.epoch
                      , rhnpackageevr.version
                      , rhnpackageevr.release
                      , rhnpackagearch.name AS arch
                      , rhnpackage.package_size
                      , rhnpackage.payload_size
                      , rhnpackage.installed_size
                      , rhnpackage.vendor
                      , rhnchannel.label AS channel_label
                      , web_customer.name AS organization 
            FROM rhnpackage
                      LEFT JOIN rhnpackagename ON rhnpackage.name_id = rhnpackagename.id
                      LEFT JOIN rhnpackageevr ON rhnpackage.evr_id = rhnpackageevr.id
                      LEFT JOIN rhnpackagearch ON rhnpackage.package_arch_id = rhnpackagearch.id
                      LEFT JOIN rhnchannelpackage ON rhnpackage.id = rhnchannelpackage.package_id
                      LEFT JOIN rhnchannel ON rhnchannelpackage.channel_id = rhnchannel.id
                      LEFT JOIN web_customer ON rhnpackage.org_id = web_customer.id
  </query>
</mode>

<mode name="SystemErrata" class="">
    <query>
          SELECT rhnserverneedederratacache.server_id AS system_id
                      , rhnserverneedederratacache.errata_id
                      , rhnserver.hostname
                      , rhnerrata.advisory_name
                      , rhnerrata.advisory_type
           FROM rhnserverneedederratacache
                      LEFT JOIN rhnserver ON rhnserverneedederratacache.server_id = rhnserver.id
                      LEFT JOIN rhnerrata ON rhnserverneedederratacache.errata_id = rhnerrata.id
  </query>
</mode>

</datasource_modes>
